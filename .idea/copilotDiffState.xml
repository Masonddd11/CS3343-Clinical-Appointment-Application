<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/hospital/management/demo/config/DataInitializer.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/hospital/management/demo/config/DataInitializer.java" />
              <option name="originalContent" value="package com.hospital.management.demo.config;&#10;&#10;import com.fasterxml.jackson.core.type.TypeReference;&#10;import com.fasterxml.jackson.databind.ObjectMapper;&#10;import com.hospital.management.demo.dto.seed.HospitalSeedDto;&#10;import com.hospital.management.demo.integration.district.DistrictMapper;&#10;import com.hospital.management.demo.model.entity.Appointment;&#10;import com.hospital.management.demo.model.entity.Department;&#10;import com.hospital.management.demo.model.entity.Doctor;&#10;import com.hospital.management.demo.model.entity.Hospital;&#10;import com.hospital.management.demo.model.entity.Patient;&#10;import com.hospital.management.demo.model.entity.Symptom;&#10;import com.hospital.management.demo.model.entity.User;&#10;import com.hospital.management.demo.model.enums.UserRole;&#10;import com.hospital.management.demo.repository.AppointmentRepository;&#10;import com.hospital.management.demo.repository.DepartmentRepository;&#10;import com.hospital.management.demo.repository.DoctorRepository;&#10;import com.hospital.management.demo.repository.HospitalDepartmentRepository;&#10;import com.hospital.management.demo.repository.HospitalRepository;&#10;import com.hospital.management.demo.repository.PatientRepository;&#10;import com.hospital.management.demo.repository.SymptomRepository;&#10;import com.hospital.management.demo.repository.UserRepository;&#10;import lombok.RequiredArgsConstructor;&#10;import lombok.extern.slf4j.Slf4j;&#10;import org.springframework.beans.factory.annotation.Value;&#10;import org.springframework.boot.CommandLineRunner;&#10;import org.springframework.core.io.ClassPathResource;&#10;import org.springframework.security.crypto.password.PasswordEncoder;&#10;import org.springframework.stereotype.Component;&#10;&#10;import java.io.IOException;&#10;import java.io.InputStream;&#10;import java.time.LocalDate;&#10;import java.time.LocalTime;&#10;import java.util.Collections;&#10;import java.util.List;&#10;import java.util.Map;&#10;import java.util.Optional;&#10;import java.util.stream.Collectors;&#10;&#10;@Component&#10;@RequiredArgsConstructor&#10;@Slf4j&#10;public class DataInitializer implements CommandLineRunner {&#10;&#10;    private final UserRepository userRepository;&#10;    private final PasswordEncoder passwordEncoder;&#10;    private final HospitalRepository hospitalRepository;&#10;    private final DepartmentRepository departmentRepository;&#10;    private final HospitalDepartmentRepository hospitalDepartmentRepository;&#10;    private final DoctorRepository doctorRepository;&#10;    private final PatientRepository patientRepository;&#10;    private final SymptomRepository symptomRepository;&#10;    private final AppointmentRepository appointmentRepository;&#10;    private final ObjectMapper objectMapper;&#10;    private final DistrictMapper districtMapper;&#10;&#10;    private static final String HOSPITAL_SEED_FILE = &quot;hospital.Json&quot;;&#10;    private static final double AE_INTENSITY = 0.45;&#10;    private static final double NON_AE_INTENSITY = 0.25;&#10;    private static final int AE_CAPACITY = 1200;&#10;    private static final int NON_AE_CAPACITY = 600;&#10;&#10;    private static final List&lt;DepartmentSeed&gt; DEPARTMENT_SEEDS = List.of(&#10;            new DepartmentSeed(&quot;Cardiology&quot;, &quot;CAR&quot;, &quot;Heart related care&quot;),&#10;            new DepartmentSeed(&quot;Urology&quot;, &quot;URO&quot;, &quot;Kidney and urinary system treatment&quot;),&#10;            new DepartmentSeed(&quot;Neurology&quot;, &quot;NEU&quot;, &quot;Brain and nervous system disorders&quot;),&#10;            new DepartmentSeed(&quot;Orthopedics&quot;, &quot;ORT&quot;, &quot;Bone and joint injuries&quot;),&#10;            new DepartmentSeed(&quot;Dermatology&quot;, &quot;DER&quot;, &quot;Skin, hair, and nail conditions&quot;),&#10;            new DepartmentSeed(&quot;Gastroenterology&quot;, &quot;GAS&quot;, &quot;Digestive system issues&quot;),&#10;            new DepartmentSeed(&quot;Ophthalmology&quot;, &quot;OPH&quot;, &quot;Eye and vision care&quot;),&#10;            new DepartmentSeed(&quot;Otolaryngology&quot;, &quot;ENT&quot;, &quot;Ear, nose, and throat treatment&quot;),&#10;            new DepartmentSeed(&quot;Pulmonology&quot;, &quot;PUL&quot;, &quot;Lung and respiratory care&quot;),&#10;            new DepartmentSeed(&quot;Endocrinology&quot;, &quot;END&quot;, &quot;Hormone and metabolic disorders&quot;)&#10;    );&#10;&#10;    private static final List&lt;DoctorSeed&gt; DOCTOR_SEEDS = List.of(&#10;            new DoctorSeed(&quot;doctor@hospital.com&quot;, &quot;doctor123&quot;, &quot;Alice&quot;, &quot;Wong&quot;, &quot;12345678&quot;, &quot;Urology&quot;, &quot;MBBS, FRCS&quot;, &quot;Specialist in kidney care&quot;, &quot;Queen Elizabeth Hospital&quot;, &quot;URO&quot;),&#10;            new DoctorSeed(&quot;cardio@hospital.com&quot;, &quot;doctor123&quot;, &quot;Ben&quot;, &quot;Lee&quot;, &quot;87654321&quot;, &quot;Cardiology&quot;, &quot;MBBS, MRCP&quot;, &quot;Experienced cardiologist&quot;, &quot;Queen Elizabeth Hospital&quot;, &quot;CAR&quot;),&#10;            new DoctorSeed(&quot;neuro@hospital.com&quot;, &quot;doctor123&quot;, &quot;Carol&quot;, &quot;Ho&quot;, &quot;61234567&quot;, &quot;Neurology&quot;, &quot;MBBS, FRCP&quot;, &quot;Brain and nervous system specialist&quot;, &quot;Queen Elizabeth Hospital&quot;, &quot;NEU&quot;),&#10;            new DoctorSeed(&quot;ortho@hospital.com&quot;, &quot;doctor123&quot;, &quot;David&quot;, &quot;Lam&quot;, &quot;69876543&quot;, &quot;Orthopedics&quot;, &quot;MBBS, FRCS(Ortho)&quot;, &quot;Bone and joint surgeon&quot;, &quot;Princess Margaret Hospital&quot;, &quot;ORT&quot;),&#10;            new DoctorSeed(&quot;derma@hospital.com&quot;, &quot;doctor123&quot;, &quot;Eva&quot;, &quot;Ng&quot;, &quot;93456781&quot;, &quot;Dermatology&quot;, &quot;MBBS, MRCP(Derm)&quot;, &quot;Skin specialist&quot;, &quot;Queen Elizabeth Hospital&quot;, &quot;DER&quot;),&#10;            // Demo doctors for Kwong Wah Hospital covering all seeded departments&#10;            new DoctorSeed(&quot;kwongwah-cardio@hospital.com&quot;, &quot;doctor123&quot;, &quot;Lydia&quot;, &quot;Chung&quot;, &quot;93110001&quot;, &quot;Cardiology&quot;, &quot;MBBS, MRCP&quot;, &quot;Cardiologist at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;CAR&quot;),&#10;            new DoctorSeed(&quot;kwongwah-uro@hospital.com&quot;, &quot;doctor123&quot;, &quot;Michael&quot;, &quot;Tam&quot;, &quot;93110002&quot;, &quot;Urology&quot;, &quot;MBBS, FRCS&quot;, &quot;Urology specialist at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;URO&quot;),&#10;            new DoctorSeed(&quot;kwongwah-neuro@hospital.com&quot;, &quot;doctor123&quot;, &quot;Siu&quot;, &quot;Chan&quot;, &quot;93110003&quot;, &quot;Neurology&quot;, &quot;MBBS, FRCP&quot;, &quot;Neurologist at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;NEU&quot;),&#10;            new DoctorSeed(&quot;kwongwah-ortho@hospital.com&quot;, &quot;doctor123&quot;, &quot;Grace&quot;, &quot;Wong&quot;, &quot;93110004&quot;, &quot;Orthopedics&quot;, &quot;MBBS, FRCS(Ortho)&quot;, &quot;Orthopedic surgeon at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;ORT&quot;),&#10;            new DoctorSeed(&quot;kwongwah-derm@hospital.com&quot;, &quot;doctor123&quot;, &quot;Victor&quot;, &quot;Ho&quot;, &quot;93110005&quot;, &quot;Dermatology&quot;, &quot;MBBS, MRCP(Derm)&quot;, &quot;Dermatologist at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;DER&quot;),&#10;            new DoctorSeed(&quot;kwongwah-gast@hospital.com&quot;, &quot;doctor123&quot;, &quot;Anita&quot;, &quot;Leung&quot;, &quot;93110006&quot;, &quot;Gastroenterology&quot;, &quot;MBBS, FRCP&quot;, &quot;Gastroenterologist at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;GAS&quot;),&#10;            new DoctorSeed(&quot;kwongwah-oph@hospital.com&quot;, &quot;doctor123&quot;, &quot;Thomas&quot;, &quot;Yip&quot;, &quot;93110007&quot;, &quot;Ophthalmology&quot;, &quot;MBBS, FRCOphth&quot;, &quot;Ophthalmologist at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;OPH&quot;),&#10;            new DoctorSeed(&quot;kwongwah-ent@hospital.com&quot;, &quot;doctor123&quot;, &quot;Nancy&quot;, &quot;Kwan&quot;, &quot;93110008&quot;, &quot;Otolaryngology&quot;, &quot;MBBS, FRCS(ENT)&quot;, &quot;ENT specialist at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;ENT&quot;),&#10;            new DoctorSeed(&quot;kwongwah-pul@hospital.com&quot;, &quot;doctor123&quot;, &quot;Eric&quot;, &quot;Choi&quot;, &quot;93110009&quot;, &quot;Pulmonology&quot;, &quot;MBBS, MRCP&quot;, &quot;Pulmonologist at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;PUL&quot;),&#10;            new DoctorSeed(&quot;kwongwah-end@hospital.com&quot;, &quot;doctor123&quot;, &quot;Helen&quot;, &quot;Cheung&quot;, &quot;93110010&quot;, &quot;Endocrinology&quot;, &quot;MBBS, FRCP&quot;, &quot;Endocrinologist at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;END&quot;)&#10;    );&#10;&#10;    private static final List&lt;SymptomSeed&gt; SYMPTOM_SEEDS = List.of(&#10;            new SymptomSeed(&quot;kidney pain&quot;, &quot;URO&quot;, 1, List.of(&quot;renal pain&quot;, &quot;flank pain&quot;, &quot;kidney discomfort&quot;, &quot;urinary pain&quot;)),&#10;            new SymptomSeed(&quot;heart pain&quot;, &quot;CAR&quot;, 1, List.of(&quot;chest pain&quot;, &quot;cardiac pain&quot;, &quot;chest tightness&quot;, &quot;palpitations&quot;)),&#10;            new SymptomSeed(&quot;migraine&quot;, &quot;NEU&quot;, 2, List.of(&quot;headache&quot;, &quot;throbbing head&quot;, &quot;light sensitivity&quot;, &quot;aura&quot;)),&#10;            new SymptomSeed(&quot;back injury&quot;, &quot;ORT&quot;, 2, List.of(&quot;fracture&quot;, &quot;sprain&quot;, &quot;joint pain&quot;, &quot;bone pain&quot;)),&#10;            new SymptomSeed(&quot;skin rash&quot;, &quot;DER&quot;, 2, List.of(&quot;itchy skin&quot;, &quot;red patches&quot;, &quot;eczema&quot;, &quot;dermatitis&quot;)),&#10;            new SymptomSeed(&quot;stomach ache&quot;, &quot;GAS&quot;, 2, List.of(&quot;abdominal pain&quot;, &quot;bloating&quot;, &quot;acid reflux&quot;, &quot;indigestion&quot;)),&#10;            new SymptomSeed(&quot;blurred vision&quot;, &quot;OPH&quot;, 2, List.of(&quot;vision loss&quot;, &quot;eye pain&quot;, &quot;double vision&quot;, &quot;dry eyes&quot;)),&#10;            new SymptomSeed(&quot;sore throat&quot;, &quot;ENT&quot;, 3, List.of(&quot;ear pain&quot;, &quot;blocked nose&quot;, &quot;sinus&quot;, &quot;hoarseness&quot;)),&#10;            new SymptomSeed(&quot;shortness of breath&quot;, &quot;PUL&quot;, 1, List.of(&quot;wheezing&quot;, &quot;cough&quot;, &quot;respiratory distress&quot;, &quot;asthma&quot;)),&#10;            new SymptomSeed(&quot;excessive thirst&quot;, &quot;END&quot;, 2, List.of(&quot;fatigue&quot;, &quot;weight change&quot;, &quot;blood sugar&quot;, &quot;hormone&quot;))&#10;    );&#10;&#10;    @Value(&quot;${admin.default.email:admin@hospital.com}&quot;)&#10;    private String defaultAdminEmail;&#10;&#10;    @Value(&quot;${admin.default.password:admin123}&quot;)&#10;    private String defaultAdminPassword;&#10;&#10;    @Override&#10;    public void run(String... args) {&#10;        initializeAdminUser();&#10;        initializeDemoData();&#10;    }&#10;&#10;    private void initializeAdminUser() {&#10;        if (userRepository.countByRole(UserRole.ADMIN) &gt; 0) {&#10;            log.info(&quot;Admin user already exists. Skipping default admin creation.&quot;);&#10;            return;&#10;        }&#10;&#10;        log.info(&quot;No admin user found. Creating default admin user...&quot;);&#10;&#10;        User adminUser = User.builder()&#10;                .email(defaultAdminEmail)&#10;                .password(passwordEncoder.encode(defaultAdminPassword))&#10;                .role(UserRole.ADMIN)&#10;                .isActive(true)&#10;                .build();&#10;&#10;        userRepository.save(adminUser);&#10;        log.info(&quot;Default admin user created successfully!&quot;);&#10;        log.info(&quot;Email: {}&quot;, defaultAdminEmail);&#10;        log.info(&quot;Password: {}&quot;, defaultAdminPassword);&#10;        log.warn(&quot;Please change the default admin password after first login!&quot;);&#10;    }&#10;&#10;    private void initializeDemoData() {&#10;        List&lt;HospitalSeedDto&gt; hospitalSeedData = loadHospitalSeedData();&#10;        if (hospitalSeedData.isEmpty()) {&#10;            log.error(&quot;Hospital seed data not available. Skipping hospital initialization.&quot;);&#10;            return;&#10;        }&#10;&#10;        hospitalSeedData.forEach(this::upsertHospitalFromSeed);&#10;        log.info(&quot;Hospital dataset synchronized from {} entries.&quot;, hospitalSeedData.size());&#10;&#10;        Map&lt;String, Department&gt; departmentByCode = DEPARTMENT_SEEDS.stream()&#10;                .collect(Collectors.toMap(DepartmentSeed::code, seed -&gt; createDepartmentIfNotExists(seed.name(), seed.code(), seed.description())));&#10;&#10;        Hospital queenElizabeth = findHospitalByNameOrThrow(&quot;Queen Elizabeth Hospital&quot;);&#10;        Hospital princessMargaret = findHospitalByNameOrThrow(&quot;Princess Margaret Hospital&quot;);&#10;&#10;        assignDefaultDepartments(List.of(queenElizabeth, princessMargaret), departmentByCode);&#10;&#10;        List&lt;Doctor&gt; seededDoctors = DOCTOR_SEEDS.stream()&#10;                .map(seed -&gt; createDoctorIfNotExists(&#10;                        seed.email(),&#10;                        seed.password(),&#10;                        seed.firstName(),&#10;                        seed.lastName(),&#10;                        seed.phone(),&#10;                        seed.specialization(),&#10;                        seed.qualifications(),&#10;                        seed.bio(),&#10;                        findHospitalByNameOrThrow(seed.hospitalName()),&#10;                        departmentByCode.get(seed.departmentCode())&#10;                ))&#10;                .toList();&#10;&#10;        Doctor doctorWong = seededDoctors.stream()&#10;                .filter(doc -&gt; doc.getUser().getEmail().equals(&quot;doctor@hospital.com&quot;))&#10;                .findFirst()&#10;                .orElseThrow();&#10;&#10;        Patient patientChan = createPatientIfNotExists(&#10;                &quot;patient@test.com&quot;,&#10;                &quot;patient123&quot;,&#10;                &quot;Bob&quot;,&#10;                &quot;Chan&quot;,&#10;                &quot;91234567&quot;,&#10;                &quot;Kowloon&quot;,&#10;                22.33,&#10;                114.17&#10;        );&#10;&#10;        SYMPTOM_SEEDS.forEach(seed -&gt; createSymptomIfNotExists(&#10;                seed.name(),&#10;                departmentByCode.get(seed.departmentCode()),&#10;                seed.priority(),&#10;                seed.keywords()&#10;        ));&#10;&#10;        createSampleAppointmentIfAbsent(patientChan, doctorWong, queenElizabeth, departmentByCode.get(&quot;URO&quot;));&#10;    }&#10;&#10;    private List&lt;HospitalSeedDto&gt; loadHospitalSeedData() {&#10;        ClassPathResource resource = new ClassPathResource(HOSPITAL_SEED_FILE);&#10;        if (!resource.exists()) {&#10;            log.error(&quot;Hospital seed file {} not found on classpath.&quot;, HOSPITAL_SEED_FILE);&#10;            return Collections.emptyList();&#10;        }&#10;        try (InputStream inputStream = resource.getInputStream()) {&#10;            return objectMapper.readValue(inputStream, new TypeReference&lt;&gt;() {});&#10;        } catch (IOException ex) {&#10;            log.error(&quot;Failed to parse hospital seed JSON.&quot;, ex);&#10;            return Collections.emptyList();&#10;        }&#10;    }&#10;&#10;    private void upsertHospitalFromSeed(HospitalSeedDto seed) {&#10;        if (seed == null || seed.institutionEng() == null) {&#10;            log.warn(&quot;Encountered hospital seed entry with missing institution name. Skipping entry: {}&quot;, seed);&#10;            return;&#10;        }&#10;        if (seed.latitude() == null || seed.longitude() == null) {&#10;            log.warn(&quot;Hospital entry {} missing coordinates. Skipping.&quot;, seed.institutionEng());&#10;            return;&#10;        }&#10;&#10;        Hospital hospital = hospitalRepository.findByName(seed.institutionEng())&#10;                .orElseGet(() -&gt; Hospital.builder().name(seed.institutionEng()).build());&#10;&#10;        hospital.setAddress(seed.addressEng());&#10;        hospital.setLatitude(seed.latitude());&#10;        hospital.setLongitude(seed.longitude());&#10;        hospital.setDistrict(districtMapper.map(seed.institutionEng(), seed.clusterEng()));&#10;        hospital.setCapacity(determineCapacity(seed));&#10;        hospital.setCurrentIntensity(seed.hasAccidentAndEmergency() ? AE_INTENSITY : NON_AE_INTENSITY);&#10;        hospital.setHasAccidentAndEmergency(seed.hasAccidentAndEmergency());&#10;&#10;        hospitalRepository.save(hospital);&#10;        log.debug(&quot;Upserted hospital entry: {}&quot;, seed.institutionEng());&#10;    }&#10;&#10;    private int determineCapacity(HospitalSeedDto seed) {&#10;        return seed.hasAccidentAndEmergency() ? AE_CAPACITY : NON_AE_CAPACITY;&#10;    }&#10;&#10;    private Hospital findHospitalByNameOrThrow(String name) {&#10;        return hospitalRepository.findByName(name)&#10;                .orElseThrow(() -&gt; new IllegalStateException(&quot;Required hospital not found in seed data: &quot; + name));&#10;    }&#10;&#10;    private Department createDepartmentIfNotExists(String name, String code, String description) {&#10;        return departmentRepository.findByCode(code)&#10;                .orElseGet(() -&gt; {&#10;                    Department dept = Department.builder()&#10;                            .name(name)&#10;                            .code(code)&#10;                            .description(description)&#10;                            .build();&#10;                    log.info(&quot;Created demo department: {}&quot;, name);&#10;                    return departmentRepository.save(dept);&#10;                });&#10;    }&#10;&#10;    private void assignDepartmentToHospital(Hospital hospital, Department department) {&#10;        boolean exists = hospitalDepartmentRepository&#10;                .findByHospitalIdAndDepartmentId(hospital.getId(), department.getId())&#10;                .isPresent();&#10;&#10;        if (exists) {&#10;            return;&#10;        }&#10;&#10;        hospitalDepartmentRepository.save(&#10;                com.hospital.management.demo.model.entity.HospitalDepartment.builder()&#10;                        .hospital(hospital)&#10;                        .department(department)&#10;                        .isActive(true)&#10;                        .build()&#10;        );&#10;        log.info(&quot;Assigned department {} to hospital {}&quot;, department.getName(), hospital.getName());&#10;    }&#10;&#10;    private Doctor createDoctorIfNotExists(String email,&#10;                                           String password,&#10;                                           String firstName,&#10;                                           String lastName,&#10;                                           String phone,&#10;                                           String specialization,&#10;                                           String qualifications,&#10;                                           String bio,&#10;                                           Hospital hospital,&#10;                                           Department department) {&#10;&#10;        Optional&lt;User&gt; existingUser = userRepository.findByEmail(email);&#10;        if (existingUser.isPresent()) {&#10;            return doctorRepository.findByUserId(existingUser.get().getId())&#10;                    .orElseThrow();&#10;        }&#10;&#10;        User user = User.builder()&#10;                .email(email)&#10;                .password(passwordEncoder.encode(password))&#10;                .role(UserRole.DOCTOR)&#10;                .isActive(true)&#10;                .build();&#10;&#10;        Doctor doctor = Doctor.builder()&#10;                .user(user)&#10;                .hospital(hospital)&#10;                .department(department)&#10;                .firstName(firstName)&#10;                .lastName(lastName)&#10;                .phoneNumber(phone)&#10;                .specialization(specialization)&#10;                .qualifications(qualifications)&#10;                .bio(bio)&#10;                .build();&#10;&#10;        doctor = doctorRepository.save(doctor);&#10;        log.info(&quot;Created demo doctor: {} {}&quot;, firstName, lastName);&#10;        return doctor;&#10;    }&#10;&#10;    private Patient createPatientIfNotExists(String email,&#10;                                             String password,&#10;                                             String firstName,&#10;                                             String lastName,&#10;                                             String phone,&#10;                                             String district,&#10;                                             Double latitude,&#10;                                             Double longitude) {&#10;        Optional&lt;User&gt; existingUser = userRepository.findByEmail(email);&#10;        if (existingUser.isPresent()) {&#10;            return patientRepository.findByUserId(existingUser.get().getId())&#10;                    .orElseThrow();&#10;        }&#10;&#10;        User user = User.builder()&#10;                .email(email)&#10;                .password(passwordEncoder.encode(password))&#10;                .role(UserRole.PATIENT)&#10;                .isActive(true)&#10;                .build();&#10;&#10;        Patient patient = Patient.builder()&#10;                .user(user)&#10;                .firstName(firstName)&#10;                .lastName(lastName)&#10;                .phoneNumber(phone)&#10;                .dateOfBirth(LocalDate.of(1990, 1, 1))&#10;                .address(district)&#10;                .district(district)&#10;                .latitude(latitude)&#10;                .longitude(longitude)&#10;                .build();&#10;&#10;        patient = patientRepository.save(patient);&#10;        log.info(&quot;Created demo patient: {} {}&quot;, firstName, lastName);&#10;        return patient;&#10;    }&#10;&#10;    private void createSymptomIfNotExists(String symptomText, Department department, int priority, List&lt;String&gt; keywords) {&#10;        boolean exists = symptomRepository.findBySymptomContainingIgnoreCase(symptomText).stream()&#10;                .anyMatch(symptom -&gt; symptom.getSymptom().equalsIgnoreCase(symptomText));&#10;&#10;        if (exists) {&#10;            return;&#10;        }&#10;&#10;        Symptom symptom = Symptom.builder()&#10;                .symptom(symptomText)&#10;                .recommendedDepartment(department)&#10;                .priority(priority)&#10;                .keywords(keywords)&#10;                .build();&#10;&#10;        symptomRepository.save(symptom);&#10;        log.info(&quot;Created demo symptom: {}&quot;, symptomText);&#10;    }&#10;&#10;    private void createSampleAppointmentIfAbsent(Patient patient,&#10;                                                 Doctor doctor,&#10;                                                 Hospital hospital,&#10;                                                 Department department) {&#10;        LocalDate appointmentDate = LocalDate.now().plusDays(3);&#10;        LocalTime appointmentTime = LocalTime.of(10, 0);&#10;&#10;        boolean exists = appointmentRepository.existsByDoctorIdAndAppointmentDateAndAppointmentTimeAndStatusNot(&#10;                doctor.getId(),&#10;                appointmentDate,&#10;                appointmentTime,&#10;                com.hospital.management.demo.model.enums.AppointmentStatus.CANCELLED&#10;        );&#10;&#10;        if (exists) {&#10;            return;&#10;        }&#10;&#10;        Appointment appointment = Appointment.builder()&#10;                .patient(patient)&#10;                .doctor(doctor)&#10;                .hospital(hospital)&#10;                .department(department)&#10;                .appointmentDate(appointmentDate)&#10;                .appointmentTime(appointmentTime)&#10;                .reasonForVisit(&quot;Follow-up consultation&quot;)&#10;                .symptoms(&quot;Kidney discomfort&quot;)&#10;                .status(com.hospital.management.demo.model.enums.AppointmentStatus.CONFIRMED)&#10;                .build();&#10;&#10;        appointmentRepository.save(appointment);&#10;        log.info(&quot;Created demo appointment on {} at {}&quot;, appointmentDate, appointmentTime);&#10;    }&#10;&#10;    private void assignDefaultDepartments(List&lt;Hospital&gt; hospitals, Map&lt;String, Department&gt; departments) {&#10;        hospitals.forEach(hospital -&gt; departments.values().forEach(dept -&gt; {&#10;            if ((hospital.getName().contains(&quot;Queen&quot;) &amp;&amp; !List.of(&quot;ENT&quot;, &quot;PUL&quot;, &quot;END&quot;).contains(dept.getCode())) ||&#10;                (hospital.getName().contains(&quot;Princess&quot;) &amp;&amp; List.of(&quot;URO&quot;, &quot;ORT&quot;, &quot;DER&quot;, &quot;OPH&quot;).contains(dept.getCode()))) {&#10;                assignDepartmentToHospital(hospital, dept);&#10;            }&#10;        }));&#10;    }&#10;&#10;    private record DepartmentSeed(String name, String code, String description) {}&#10;    private record DoctorSeed(String email, String password, String firstName, String lastName, String phone,&#10;                              String specialization, String qualifications, String bio,&#10;                              String hospitalName, String departmentCode) {}&#10;    private record SymptomSeed(String name, String departmentCode, int priority, List&lt;String&gt; keywords) {}&#10;}&#10;" />
              <option name="updatedContent" value="package com.hospital.management.demo.config;&#13;&#10;&#13;&#10;import com.fasterxml.jackson.core.type.TypeReference;&#13;&#10;import com.fasterxml.jackson.databind.ObjectMapper;&#13;&#10;import com.hospital.management.demo.dto.seed.HospitalSeedDto;&#13;&#10;import com.hospital.management.demo.integration.district.DistrictMapper;&#13;&#10;import com.hospital.management.demo.model.entity.Appointment;&#13;&#10;import com.hospital.management.demo.model.entity.Department;&#13;&#10;import com.hospital.management.demo.model.entity.Doctor;&#13;&#10;import com.hospital.management.demo.model.entity.Hospital;&#13;&#10;import com.hospital.management.demo.model.entity.Patient;&#13;&#10;import com.hospital.management.demo.model.entity.Symptom;&#13;&#10;import com.hospital.management.demo.model.entity.User;&#13;&#10;import com.hospital.management.demo.model.enums.UserRole;&#13;&#10;import com.hospital.management.demo.repository.AppointmentRepository;&#13;&#10;import com.hospital.management.demo.repository.DepartmentRepository;&#13;&#10;import com.hospital.management.demo.repository.DoctorRepository;&#13;&#10;import com.hospital.management.demo.repository.HospitalDepartmentRepository;&#13;&#10;import com.hospital.management.demo.repository.HospitalRepository;&#13;&#10;import com.hospital.management.demo.repository.PatientRepository;&#13;&#10;import com.hospital.management.demo.repository.SymptomRepository;&#13;&#10;import com.hospital.management.demo.repository.UserRepository;&#13;&#10;import lombok.RequiredArgsConstructor;&#13;&#10;import lombok.extern.slf4j.Slf4j;&#13;&#10;import org.springframework.beans.factory.annotation.Value;&#13;&#10;import org.springframework.boot.CommandLineRunner;&#13;&#10;import org.springframework.core.io.ClassPathResource;&#13;&#10;import org.springframework.security.crypto.password.PasswordEncoder;&#13;&#10;import org.springframework.stereotype.Component;&#13;&#10;&#13;&#10;import java.io.IOException;&#13;&#10;import java.io.InputStream;&#13;&#10;import java.time.LocalDate;&#13;&#10;import java.time.LocalTime;&#13;&#10;import java.util.Collections;&#13;&#10;import java.util.List;&#13;&#10;import java.util.Map;&#13;&#10;import java.util.Optional;&#13;&#10;import java.util.stream.Collectors;&#13;&#10;&#13;&#10;@Component&#13;&#10;@RequiredArgsConstructor&#13;&#10;@Slf4j&#13;&#10;public class DataInitializer implements CommandLineRunner {&#13;&#10;&#13;&#10;    private final UserRepository userRepository;&#13;&#10;    private final PasswordEncoder passwordEncoder;&#13;&#10;    private final HospitalRepository hospitalRepository;&#13;&#10;    private final DepartmentRepository departmentRepository;&#13;&#10;    private final HospitalDepartmentRepository hospitalDepartmentRepository;&#13;&#10;    private final DoctorRepository doctorRepository;&#13;&#10;    private final PatientRepository patientRepository;&#13;&#10;    private final SymptomRepository symptomRepository;&#13;&#10;    private final AppointmentRepository appointmentRepository;&#13;&#10;    private final ObjectMapper objectMapper;&#13;&#10;    private final DistrictMapper districtMapper;&#13;&#10;&#13;&#10;    private static final String HOSPITAL_SEED_FILE = &quot;hospital.Json&quot;;&#13;&#10;    private static final double AE_INTENSITY = 0.45;&#13;&#10;    private static final double NON_AE_INTENSITY = 0.25;&#13;&#10;    private static final int AE_CAPACITY = 1200;&#13;&#10;    private static final int NON_AE_CAPACITY = 600;&#13;&#10;&#13;&#10;    private static final List&lt;DepartmentSeed&gt; DEPARTMENT_SEEDS = List.of(&#13;&#10;            new DepartmentSeed(&quot;Cardiology&quot;, &quot;CAR&quot;, &quot;Heart related care&quot;),&#13;&#10;            new DepartmentSeed(&quot;Urology&quot;, &quot;URO&quot;, &quot;Kidney and urinary system treatment&quot;),&#13;&#10;            new DepartmentSeed(&quot;Neurology&quot;, &quot;NEU&quot;, &quot;Brain and nervous system disorders&quot;),&#13;&#10;            new DepartmentSeed(&quot;Orthopedics&quot;, &quot;ORT&quot;, &quot;Bone and joint injuries&quot;),&#13;&#10;            new DepartmentSeed(&quot;Dermatology&quot;, &quot;DER&quot;, &quot;Skin, hair, and nail conditions&quot;),&#13;&#10;            new DepartmentSeed(&quot;Gastroenterology&quot;, &quot;GAS&quot;, &quot;Digestive system issues&quot;),&#13;&#10;            new DepartmentSeed(&quot;Ophthalmology&quot;, &quot;OPH&quot;, &quot;Eye and vision care&quot;),&#13;&#10;            new DepartmentSeed(&quot;Otolaryngology&quot;, &quot;ENT&quot;, &quot;Ear, nose, and throat treatment&quot;),&#13;&#10;            new DepartmentSeed(&quot;Pulmonology&quot;, &quot;PUL&quot;, &quot;Lung and respiratory care&quot;),&#13;&#10;            new DepartmentSeed(&quot;Endocrinology&quot;, &quot;END&quot;, &quot;Hormone and metabolic disorders&quot;)&#13;&#10;    );&#13;&#10;&#13;&#10;    private static final List&lt;DoctorSeed&gt; DOCTOR_SEEDS = List.of(&#13;&#10;            new DoctorSeed(&quot;doctor@hospital.com&quot;, &quot;doctor123&quot;, &quot;Alice&quot;, &quot;Wong&quot;, &quot;12345678&quot;, &quot;Urology&quot;, &quot;MBBS, FRCS&quot;, &quot;Specialist in kidney care&quot;, &quot;Queen Elizabeth Hospital&quot;, &quot;URO&quot;),&#13;&#10;            new DoctorSeed(&quot;cardio@hospital.com&quot;, &quot;doctor123&quot;, &quot;Ben&quot;, &quot;Lee&quot;, &quot;87654321&quot;, &quot;Cardiology&quot;, &quot;MBBS, MRCP&quot;, &quot;Experienced cardiologist&quot;, &quot;Queen Elizabeth Hospital&quot;, &quot;CAR&quot;),&#13;&#10;            new DoctorSeed(&quot;neuro@hospital.com&quot;, &quot;doctor123&quot;, &quot;Carol&quot;, &quot;Ho&quot;, &quot;61234567&quot;, &quot;Neurology&quot;, &quot;MBBS, FRCP&quot;, &quot;Brain and nervous system specialist&quot;, &quot;Queen Elizabeth Hospital&quot;, &quot;NEU&quot;),&#13;&#10;            new DoctorSeed(&quot;ortho@hospital.com&quot;, &quot;doctor123&quot;, &quot;David&quot;, &quot;Lam&quot;, &quot;69876543&quot;, &quot;Orthopedics&quot;, &quot;MBBS, FRCS(Ortho)&quot;, &quot;Bone and joint surgeon&quot;, &quot;Princess Margaret Hospital&quot;, &quot;ORT&quot;),&#13;&#10;            new DoctorSeed(&quot;derma@hospital.com&quot;, &quot;doctor123&quot;, &quot;Eva&quot;, &quot;Ng&quot;, &quot;93456781&quot;, &quot;Dermatology&quot;, &quot;MBBS, MRCP(Derm)&quot;, &quot;Skin specialist&quot;, &quot;Queen Elizabeth Hospital&quot;, &quot;DER&quot;),&#13;&#10;            // Demo doctors for Kwong Wah Hospital covering all seeded departments&#13;&#10;            new DoctorSeed(&quot;kwongwah-cardio@hospital.com&quot;, &quot;doctor123&quot;, &quot;Lydia&quot;, &quot;Chung&quot;, &quot;93110001&quot;, &quot;Cardiology&quot;, &quot;MBBS, MRCP&quot;, &quot;Cardiologist at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;CAR&quot;),&#13;&#10;            new DoctorSeed(&quot;kwongwah-uro@hospital.com&quot;, &quot;doctor123&quot;, &quot;Michael&quot;, &quot;Tam&quot;, &quot;93110002&quot;, &quot;Urology&quot;, &quot;MBBS, FRCS&quot;, &quot;Urology specialist at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;URO&quot;),&#13;&#10;            new DoctorSeed(&quot;kwongwah-neuro@hospital.com&quot;, &quot;doctor123&quot;, &quot;Siu&quot;, &quot;Chan&quot;, &quot;93110003&quot;, &quot;Neurology&quot;, &quot;MBBS, FRCP&quot;, &quot;Neurologist at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;NEU&quot;),&#13;&#10;            new DoctorSeed(&quot;kwongwah-ortho@hospital.com&quot;, &quot;doctor123&quot;, &quot;Grace&quot;, &quot;Wong&quot;, &quot;93110004&quot;, &quot;Orthopedics&quot;, &quot;MBBS, FRCS(Ortho)&quot;, &quot;Orthopedic surgeon at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;ORT&quot;),&#13;&#10;            new DoctorSeed(&quot;kwongwah-derm@hospital.com&quot;, &quot;doctor123&quot;, &quot;Victor&quot;, &quot;Ho&quot;, &quot;93110005&quot;, &quot;Dermatology&quot;, &quot;MBBS, MRCP(Derm)&quot;, &quot;Dermatologist at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;DER&quot;),&#13;&#10;            new DoctorSeed(&quot;kwongwah-gast@hospital.com&quot;, &quot;doctor123&quot;, &quot;Anita&quot;, &quot;Leung&quot;, &quot;93110006&quot;, &quot;Gastroenterology&quot;, &quot;MBBS, FRCP&quot;, &quot;Gastroenterologist at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;GAS&quot;),&#13;&#10;            new DoctorSeed(&quot;kwongwah-oph@hospital.com&quot;, &quot;doctor123&quot;, &quot;Thomas&quot;, &quot;Yip&quot;, &quot;93110007&quot;, &quot;Ophthalmology&quot;, &quot;MBBS, FRCOphth&quot;, &quot;Ophthalmologist at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;OPH&quot;),&#13;&#10;            new DoctorSeed(&quot;kwongwah-ent@hospital.com&quot;, &quot;doctor123&quot;, &quot;Nancy&quot;, &quot;Kwan&quot;, &quot;93110008&quot;, &quot;Otolaryngology&quot;, &quot;MBBS, FRCS(ENT)&quot;, &quot;ENT specialist at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;ENT&quot;),&#13;&#10;            new DoctorSeed(&quot;kwongwah-pul@hospital.com&quot;, &quot;doctor123&quot;, &quot;Eric&quot;, &quot;Choi&quot;, &quot;93110009&quot;, &quot;Pulmonology&quot;, &quot;MBBS, MRCP&quot;, &quot;Pulmonologist at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;PUL&quot;),&#13;&#10;            new DoctorSeed(&quot;kwongwah-end@hospital.com&quot;, &quot;doctor123&quot;, &quot;Helen&quot;, &quot;Cheung&quot;, &quot;93110010&quot;, &quot;Endocrinology&quot;, &quot;MBBS, FRCP&quot;, &quot;Endocrinologist at Kwong Wah&quot;, &quot;Kwong Wah Hospital&quot;, &quot;END&quot;)&#13;&#10;    );&#13;&#10;&#13;&#10;    private static final List&lt;SymptomSeed&gt; SYMPTOM_SEEDS = List.of(&#13;&#10;            new SymptomSeed(&quot;kidney pain&quot;, &quot;URO&quot;, 1, List.of(&quot;renal pain&quot;, &quot;flank pain&quot;, &quot;kidney discomfort&quot;, &quot;urinary pain&quot;)),&#13;&#10;            new SymptomSeed(&quot;heart pain&quot;, &quot;CAR&quot;, 1, List.of(&quot;chest pain&quot;, &quot;cardiac pain&quot;, &quot;chest tightness&quot;, &quot;palpitations&quot;)),&#13;&#10;            new SymptomSeed(&quot;migraine&quot;, &quot;NEU&quot;, 2, List.of(&quot;headache&quot;, &quot;throbbing head&quot;, &quot;light sensitivity&quot;, &quot;aura&quot;)),&#13;&#10;            new SymptomSeed(&quot;back injury&quot;, &quot;ORT&quot;, 2, List.of(&quot;fracture&quot;, &quot;sprain&quot;, &quot;joint pain&quot;, &quot;bone pain&quot;)),&#13;&#10;            new SymptomSeed(&quot;skin rash&quot;, &quot;DER&quot;, 2, List.of(&quot;itchy skin&quot;, &quot;red patches&quot;, &quot;eczema&quot;, &quot;dermatitis&quot;)),&#13;&#10;            new SymptomSeed(&quot;stomach ache&quot;, &quot;GAS&quot;, 2, List.of(&quot;abdominal pain&quot;, &quot;bloating&quot;, &quot;acid reflux&quot;, &quot;indigestion&quot;)),&#13;&#10;            new SymptomSeed(&quot;blurred vision&quot;, &quot;OPH&quot;, 2, List.of(&quot;vision loss&quot;, &quot;eye pain&quot;, &quot;double vision&quot;, &quot;dry eyes&quot;)),&#13;&#10;            new SymptomSeed(&quot;sore throat&quot;, &quot;ENT&quot;, 3, List.of(&quot;ear pain&quot;, &quot;blocked nose&quot;, &quot;sinus&quot;, &quot;hoarseness&quot;)),&#13;&#10;            new SymptomSeed(&quot;shortness of breath&quot;, &quot;PUL&quot;, 1, List.of(&quot;wheezing&quot;, &quot;cough&quot;, &quot;respiratory distress&quot;, &quot;asthma&quot;)),&#13;&#10;            new SymptomSeed(&quot;excessive thirst&quot;, &quot;END&quot;, 2, List.of(&quot;fatigue&quot;, &quot;weight change&quot;, &quot;blood sugar&quot;, &quot;hormone&quot;))&#13;&#10;    );&#13;&#10;&#13;&#10;    @Value(&quot;${admin.default.email:admin@hospital.com}&quot;)&#13;&#10;    private String defaultAdminEmail;&#13;&#10;&#13;&#10;    @Value(&quot;${admin.default.password:admin123}&quot;)&#13;&#10;    private String defaultAdminPassword;&#13;&#10;&#13;&#10;    @Override&#13;&#10;    public void run(String... args) {&#13;&#10;        initializeAdminUser();&#13;&#10;        initializeDemoData();&#13;&#10;    }&#13;&#10;&#13;&#10;    private void initializeAdminUser() {&#13;&#10;        if (userRepository.countByRole(UserRole.ADMIN) &gt; 0) {&#13;&#10;            log.info(&quot;Admin user already exists. Skipping default admin creation.&quot;);&#13;&#10;            return;&#13;&#10;        }&#13;&#10;&#13;&#10;        log.info(&quot;No admin user found. Creating default admin user...&quot;);&#13;&#10;&#13;&#10;        User adminUser = User.builder()&#13;&#10;                .email(defaultAdminEmail)&#13;&#10;                .password(passwordEncoder.encode(defaultAdminPassword))&#13;&#10;                .role(UserRole.ADMIN)&#13;&#10;                .isActive(true)&#13;&#10;                .build();&#13;&#10;&#13;&#10;        userRepository.save(adminUser);&#13;&#10;        log.info(&quot;Default admin user created successfully!&quot;);&#13;&#10;        log.info(&quot;Email: {}&quot;, defaultAdminEmail);&#13;&#10;        log.info(&quot;Password: {}&quot;, defaultAdminPassword);&#13;&#10;        log.warn(&quot;Please change the default admin password after first login!&quot;);&#13;&#10;    }&#13;&#10;&#13;&#10;    private void initializeDemoData() {&#13;&#10;        List&lt;HospitalSeedDto&gt; hospitalSeedData = loadHospitalSeedData();&#13;&#10;        if (hospitalSeedData.isEmpty()) {&#13;&#10;            log.error(&quot;Hospital seed data not available. Skipping hospital initialization.&quot;);&#13;&#10;            return;&#13;&#10;        }&#13;&#10;&#13;&#10;        hospitalSeedData.forEach(this::upsertHospitalFromSeed);&#13;&#10;        log.info(&quot;Hospital dataset synchronized from {} entries.&quot;, hospitalSeedData.size());&#13;&#10;&#13;&#10;        Map&lt;String, Department&gt; departmentByCode = DEPARTMENT_SEEDS.stream()&#13;&#10;                .collect(Collectors.toMap(DepartmentSeed::code, seed -&gt; createDepartmentIfNotExists(seed.name(), seed.code(), seed.description())));&#13;&#10;&#13;&#10;        Hospital queenElizabeth = findHospitalByNameOrThrow(&quot;Queen Elizabeth Hospital&quot;);&#13;&#10;        Hospital princessMargaret = findHospitalByNameOrThrow(&quot;Princess Margaret Hospital&quot;);&#13;&#10;&#13;&#10;        assignDefaultDepartments(List.of(queenElizabeth, princessMargaret), departmentByCode);&#13;&#10;&#13;&#10;        List&lt;Doctor&gt; seededDoctors = DOCTOR_SEEDS.stream()&#13;&#10;                .map(seed -&gt; createDoctorIfNotExists(&#13;&#10;                        seed.email(),&#13;&#10;                        seed.password(),&#13;&#10;                        seed.firstName(),&#13;&#10;                        seed.lastName(),&#13;&#10;                        seed.phone(),&#13;&#10;                        seed.specialization(),&#13;&#10;                        seed.qualifications(),&#13;&#10;                        seed.bio(),&#13;&#10;                        findHospitalByNameOrThrow(seed.hospitalName()),&#13;&#10;                        departmentByCode.get(seed.departmentCode())&#13;&#10;                ))&#13;&#10;                .toList();&#13;&#10;&#13;&#10;        Doctor doctorWong = seededDoctors.stream()&#13;&#10;                .filter(doc -&gt; doc.getUser().getEmail().equals(&quot;doctor@hospital.com&quot;))&#13;&#10;                .findFirst()&#13;&#10;                .orElseThrow();&#13;&#10;&#13;&#10;        Patient patientChan = createPatientIfNotExists(&#13;&#10;                &quot;patient@test.com&quot;,&#13;&#10;                &quot;patient123&quot;,&#13;&#10;                &quot;Bob&quot;,&#13;&#10;                &quot;Chan&quot;,&#13;&#10;                &quot;91234567&quot;,&#13;&#10;                &quot;Kowloon&quot;,&#13;&#10;                22.33,&#13;&#10;                114.17&#13;&#10;        );&#13;&#10;&#13;&#10;        SYMPTOM_SEEDS.forEach(seed -&gt; createSymptomIfNotExists(&#13;&#10;                seed.name(),&#13;&#10;                departmentByCode.get(seed.departmentCode()),&#13;&#10;                seed.priority(),&#13;&#10;                seed.keywords()&#13;&#10;        ));&#13;&#10;&#13;&#10;        createSampleAppointmentIfAbsent(patientChan, doctorWong, queenElizabeth, departmentByCode.get(&quot;URO&quot;));&#13;&#10;    }&#13;&#10;&#13;&#10;    private List&lt;HospitalSeedDto&gt; loadHospitalSeedData() {&#13;&#10;        ClassPathResource resource = new ClassPathResource(HOSPITAL_SEED_FILE);&#13;&#10;        if (!resource.exists()) {&#13;&#10;            log.error(&quot;Hospital seed file {} not found on classpath.&quot;, HOSPITAL_SEED_FILE);&#13;&#10;            return Collections.emptyList();&#13;&#10;        }&#13;&#10;        try (InputStream inputStream = resource.getInputStream()) {&#13;&#10;            return objectMapper.readValue(inputStream, new TypeReference&lt;&gt;() {});&#13;&#10;        } catch (IOException ex) {&#13;&#10;            log.error(&quot;Failed to parse hospital seed JSON.&quot;, ex);&#13;&#10;            return Collections.emptyList();&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    private void upsertHospitalFromSeed(HospitalSeedDto seed) {&#13;&#10;        if (seed == null || seed.institutionEng() == null) {&#13;&#10;            log.warn(&quot;Encountered hospital seed entry with missing institution name. Skipping entry: {}&quot;, seed);&#13;&#10;            return;&#13;&#10;        }&#13;&#10;        if (seed.latitude() == null || seed.longitude() == null) {&#13;&#10;            log.warn(&quot;Hospital entry {} missing coordinates. Skipping.&quot;, seed.institutionEng());&#13;&#10;            return;&#13;&#10;        }&#13;&#10;&#13;&#10;        Hospital hospital = hospitalRepository.findByName(seed.institutionEng())&#13;&#10;                .orElseGet(() -&gt; Hospital.builder().name(seed.institutionEng()).build());&#13;&#10;&#13;&#10;        hospital.setAddress(seed.addressEng());&#13;&#10;        hospital.setLatitude(seed.latitude());&#13;&#10;        hospital.setLongitude(seed.longitude());&#13;&#10;        hospital.setDistrict(districtMapper.map(seed.institutionEng(), seed.clusterEng()));&#13;&#10;        hospital.setCapacity(determineCapacity(seed));&#13;&#10;        hospital.setCurrentIntensity(seed.hasAccidentAndEmergency() ? AE_INTENSITY : NON_AE_INTENSITY);&#13;&#10;        hospital.setHasAccidentAndEmergency(seed.hasAccidentAndEmergency());&#13;&#10;&#13;&#10;        hospitalRepository.save(hospital);&#13;&#10;        log.debug(&quot;Upserted hospital entry: {}&quot;, seed.institutionEng());&#13;&#10;    }&#13;&#10;&#13;&#10;    private int determineCapacity(HospitalSeedDto seed) {&#13;&#10;        return seed.hasAccidentAndEmergency() ? AE_CAPACITY : NON_AE_CAPACITY;&#13;&#10;    }&#13;&#10;&#13;&#10;    private Hospital findHospitalByNameOrThrow(String name) {&#13;&#10;        return hospitalRepository.findByName(name)&#13;&#10;                .orElseThrow(() -&gt; new IllegalStateException(&quot;Required hospital not found in seed data: &quot; + name));&#13;&#10;    }&#13;&#10;&#13;&#10;    private Department createDepartmentIfNotExists(String name, String code, String description) {&#13;&#10;        return departmentRepository.findByCode(code)&#13;&#10;                .orElseGet(() -&gt; {&#13;&#10;                    Department dept = Department.builder()&#13;&#10;                            .name(name)&#13;&#10;                            .code(code)&#13;&#10;                            .description(description)&#13;&#10;                            .build();&#13;&#10;                    log.info(&quot;Created demo department: {}&quot;, name);&#13;&#10;                    return departmentRepository.save(dept);&#13;&#10;                });&#13;&#10;    }&#13;&#10;&#13;&#10;    private void assignDepartmentToHospital(Hospital hospital, Department department) {&#13;&#10;        boolean exists = hospitalDepartmentRepository&#13;&#10;                .findByHospitalIdAndDepartmentId(hospital.getId(), department.getId())&#13;&#10;                .isPresent();&#13;&#10;&#13;&#10;        if (exists) {&#13;&#10;            return;&#13;&#10;        }&#13;&#10;&#13;&#10;        hospitalDepartmentRepository.save(&#13;&#10;                com.hospital.management.demo.model.entity.HospitalDepartment.builder()&#13;&#10;                        .hospital(hospital)&#13;&#10;                        .department(department)&#13;&#10;                        .isActive(true)&#13;&#10;                        .build()&#13;&#10;        );&#13;&#10;        log.info(&quot;Assigned department {} to hospital {}&quot;, department.getName(), hospital.getName());&#13;&#10;    }&#13;&#10;&#13;&#10;    private Doctor createDoctorIfNotExists(String email,&#13;&#10;                                           String password,&#13;&#10;                                           String firstName,&#13;&#10;                                           String lastName,&#13;&#10;                                           String phone,&#13;&#10;                                           String specialization,&#13;&#10;                                           String qualifications,&#13;&#10;                                           String bio,&#13;&#10;                                           Hospital hospital,&#13;&#10;                                           Department department) {&#13;&#10;&#13;&#10;        Optional&lt;User&gt; existingUser = userRepository.findByEmail(email);&#13;&#10;        if (existingUser.isPresent()) {&#13;&#10;            return doctorRepository.findByUserId(existingUser.get().getId())&#13;&#10;                    .orElseThrow();&#13;&#10;        }&#13;&#10;&#13;&#10;        User user = User.builder()&#13;&#10;                .email(email)&#13;&#10;                .password(passwordEncoder.encode(password))&#13;&#10;                .role(UserRole.DOCTOR)&#13;&#10;                .isActive(true)&#13;&#10;                .build();&#13;&#10;&#13;&#10;        Doctor doctor = Doctor.builder()&#13;&#10;                .user(user)&#13;&#10;                .hospital(hospital)&#13;&#10;                .department(department)&#13;&#10;                .firstName(firstName)&#13;&#10;                .lastName(lastName)&#13;&#10;                .phoneNumber(phone)&#13;&#10;                .specialization(specialization)&#13;&#10;                .qualifications(qualifications)&#13;&#10;                .bio(bio)&#13;&#10;                .build();&#13;&#10;&#13;&#10;        doctor = doctorRepository.save(doctor);&#13;&#10;        log.info(&quot;Created demo doctor: {} {}&quot;, firstName, lastName);&#13;&#10;        return doctor;&#13;&#10;    }&#13;&#10;&#13;&#10;    private Patient createPatientIfNotExists(String email,&#13;&#10;                                             String password,&#13;&#10;                                             String firstName,&#13;&#10;                                             String lastName,&#13;&#10;                                             String phone,&#13;&#10;                                             String district,&#13;&#10;                                             Double latitude,&#13;&#10;                                             Double longitude) {&#13;&#10;        Optional&lt;User&gt; existingUser = userRepository.findByEmail(email);&#13;&#10;        if (existingUser.isPresent()) {&#13;&#10;            return patientRepository.findByUserId(existingUser.get().getId())&#13;&#10;                    .orElseThrow();&#13;&#10;        }&#13;&#10;&#13;&#10;        User user = User.builder()&#13;&#10;                .email(email)&#13;&#10;                .password(passwordEncoder.encode(password))&#13;&#10;                .role(UserRole.PATIENT)&#13;&#10;                .isActive(true)&#13;&#10;                .build();&#13;&#10;&#13;&#10;        Patient patient = Patient.builder()&#13;&#10;                .user(user)&#13;&#10;                .firstName(firstName)&#13;&#10;                .lastName(lastName)&#13;&#10;                .phoneNumber(phone)&#13;&#10;                .dateOfBirth(LocalDate.of(1990, 1, 1))&#13;&#10;                .address(district)&#13;&#10;                .district(district)&#13;&#10;                .latitude(latitude)&#13;&#10;                .longitude(longitude)&#13;&#10;                .build();&#13;&#10;&#13;&#10;        patient = patientRepository.save(patient);&#13;&#10;        log.info(&quot;Created demo patient: {} {}&quot;, firstName, lastName);&#13;&#10;        return patient;&#13;&#10;    }&#13;&#10;&#13;&#10;    private void createSymptomIfNotExists(String symptomText, Department department, int priority, List&lt;String&gt; keywords) {&#13;&#10;        boolean exists = symptomRepository.findBySymptomContainingIgnoreCase(symptomText).stream()&#13;&#10;                .anyMatch(symptom -&gt; symptom.getSymptom().equalsIgnoreCase(symptomText));&#13;&#10;&#13;&#10;        if (exists) {&#13;&#10;            return;&#13;&#10;        }&#13;&#10;&#13;&#10;        Symptom symptom = Symptom.builder()&#13;&#10;                .symptom(symptomText)&#13;&#10;                .recommendedDepartment(department)&#13;&#10;                .priority(priority)&#13;&#10;                .keywords(keywords)&#13;&#10;                .build();&#13;&#10;&#13;&#10;        symptomRepository.save(symptom);&#13;&#10;        log.info(&quot;Created demo symptom: {}&quot;, symptomText);&#13;&#10;    }&#13;&#10;&#13;&#10;    private void createSampleAppointmentIfAbsent(Patient patient,&#13;&#10;                                                 Doctor doctor,&#13;&#10;                                                 Hospital hospital,&#13;&#10;                                                 Department department) {&#13;&#10;        LocalDate appointmentDate = LocalDate.now().plusDays(3);&#13;&#10;        LocalTime appointmentTime = LocalTime.of(10, 0);&#13;&#10;&#13;&#10;        boolean exists = appointmentRepository.existsByDoctorIdAndAppointmentDateAndAppointmentTimeAndStatusNot(&#13;&#10;                doctor.getId(),&#13;&#10;                appointmentDate,&#13;&#10;                appointmentTime,&#13;&#10;                com.hospital.management.demo.model.enums.AppointmentStatus.CANCELLED&#13;&#10;        );&#13;&#10;&#13;&#10;        if (exists) {&#13;&#10;            return;&#13;&#10;        }&#13;&#10;&#13;&#10;        Appointment appointment = Appointment.builder()&#13;&#10;                .patient(patient)&#13;&#10;                .doctor(doctor)&#13;&#10;                .hospital(hospital)&#13;&#10;                .department(department)&#13;&#10;                .appointmentDate(appointmentDate)&#13;&#10;                .appointmentTime(appointmentTime)&#13;&#10;                .reasonForVisit(&quot;Follow-up consultation&quot;)&#13;&#10;                .symptoms(&quot;Kidney discomfort&quot;)&#13;&#10;                .status(com.hospital.management.demo.model.enums.AppointmentStatus.CONFIRMED)&#13;&#10;                .build();&#13;&#10;&#13;&#10;        appointmentRepository.save(appointment);&#13;&#10;        log.info(&quot;Created demo appointment on {} at {}&quot;, appointmentDate, appointmentTime);&#13;&#10;    }&#13;&#10;&#13;&#10;    private void assignDefaultDepartments(List&lt;Hospital&gt; hospitals, Map&lt;String, Department&gt; departments) {&#13;&#10;        hospitals.forEach(hospital -&gt; departments.values().forEach(dept -&gt; {&#13;&#10;            if ((hospital.getName().contains(&quot;Queen&quot;) &amp;&amp; !List.of(&quot;ENT&quot;, &quot;PUL&quot;, &quot;END&quot;).contains(dept.getCode())) ||&#13;&#10;                (hospital.getName().contains(&quot;Princess&quot;) &amp;&amp; List.of(&quot;URO&quot;, &quot;ORT&quot;, &quot;DER&quot;, &quot;OPH&quot;).contains(dept.getCode()))) {&#13;&#10;                assignDepartmentToHospital(hospital, dept);&#13;&#10;            }&#13;&#10;        }));&#13;&#10;    }&#13;&#10;&#13;&#10;    private record DepartmentSeed(String name, String code, String description) {}&#13;&#10;    private record DoctorSeed(String email, String password, String firstName, String lastName, String phone,&#13;&#10;                              String specialization, String qualifications, String bio,&#13;&#10;                              String hospitalName, String departmentCode) {}&#13;&#10;    private record SymptomSeed(String name, String departmentCode, int priority, List&lt;String&gt; keywords) {}&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>